<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Kunst Diashow - Multi-Museum</title>
  <script src="spatial-navigation-polyfill.js"></script>
  <style>
    html, body {
      margin: 0;
      background: #e3e0d3;
      overflow: hidden;
      font-family: sans-serif;
    }
    #frame {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
    }
    img.artwork {
      position: relative;
      display: flex;
      width: 100%;
      height: 100%;
      align-items: center;
      justify-content: center;
      object-fit: contain;
    }
    .passepartout {
      position: relative;
      width: fit-content;
      height: fit-content;
      box-sizing: border-box;
      background-image: 
        radial-gradient(circle at 20% 80%, rgba(120, 119, 109, 0.03) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(120, 119, 109, 0.03) 0%, transparent 50%),
        radial-gradient(circle at 40% 40%, rgba(0, 0, 0, 0.01) 0%, transparent 50%);
    }
    .passepartout img.artwork{
      width: 100%;
      height: 100%;	  
      max-width: 50vw;
      max-height: 50vh;
    }
    .passepartout.modern img.artwork{
      width: 100%;
      height: 100%;	  
      max-width: 90vw;
      max-height: 90vh;
    }
    .passepartout.none {
      padding: 0px;	  
      width: 100%;
      height: 100%;
    }	
    .passepartout.none img.artwork{
      width: 100%;
      height: 100%;	  
      max-width: 100vw;
      max-height: 100vh;
    }
    .passepartout.crop{
      width: inherit;
      height: fit-content;	  
      width: 50vw;
      height: 50vh;	  
      max-width: 100vw;
      max-height: 100vh;
    }
    .passepartout.crop img.artwork{
      object-fit: cover;
    }
    .passepartout.cropMax{
      width: 100%;
      height: 100%;
      max-width: 100vw;
      max-height: 100vh;
    }
    .passepartout.cropMax img.artwork{
      object-fit: cover;
      width: 100%;
      height: 100%;	  
      max-width: 100vw;
      max-height: 100vh;
    }
    .passepartout.contain img.artwork{  
      max-width: 50vw;
      max-height: 50vh;
    }
    .inner-frame {
      background: #ffffff;
      width: inherit;
      box-shadow: 
        inset 0 2px 8px rgba(0, 0, 0, 0.15),
        inset 0 -1px 3px rgba(0, 0, 0, 0.05),
        0 1px 2px rgba(255, 255, 255, 0.8);
      border: 6px solid #e0e0e0;
      overflow: hidden;
    }
    
    #infoBox {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(0,0,0,0.85);
      color: white;
      padding: 1.5em;
      display: none;
      font-size: 1.1em;
      line-height: 1.4;
    }
    .artwork-info {
      max-width: 800px;
      margin: 0 auto;
    }
    .title-section {
      font-size: 1.3em;
      margin-bottom: 0.5em;
    }
    .title-section .date {
      font-weight: normal;
      color: #ccc;
      margin-left: 0.5em;
    }
    .artist-section {
      font-size: 1.1em;
      color: #ddd;
      margin-bottom: 1em;
    }
    .details-section {
      margin-bottom: 1em;
      font-size: 0.9em;
    }
    .details-section div {
      margin: 0.3em 0;
    }
    .credit-line {
      font-style: italic;
      color: #bbb;
    }
    .meta-section {
      margin-bottom: 0.8em;
    }
    .tag {
      display: inline-block;
      background: rgba(255,255,255,0.2);
      padding: 0.2em 0.6em;
      border-radius: 12px;
      font-size: 0.8em;
      margin: 0.2em 0.3em 0.2em 0;
      border: 1px solid rgba(255,255,255,0.3);
    }
    .tag.on-view {
      background: rgba(76, 175, 80, 0.3);
      border-color: #4caf50;
    }
    .tag.not-on-view {
      background: rgba(158, 158, 158, 0.3);
      border-color: #999;
    }
    .tag.public-domain {
      background: rgba(33, 150, 243, 0.3);
      border-color: #2196f3;
    }
    .tag.met {
      background: rgba(255, 193, 7, 0.3);
      border-color: #ffc107;
    }
    .tag.aic {
      background: rgba(156, 39, 176, 0.3);
      border-color: #9c27b0;
    }
    .tag.rijks {
      background: rgba(255, 87, 34, 0.3);
      border-color: #ff5722;
    }
    .tag.cleveland {
      background: rgba(63, 81, 181, 0.3);
      border-color: #3f51b5;
    }
    .source-section {
      font-size: 0.8em;
      color: #aaa;
      display: flex;
      justify-content: space-between;
    }
    
    #menuOverlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.95);
      color: white;
      display: none;
      overflow: hidden;
    }
    
    .menu-container {
      display: flex;
      height: 100vh;
    }
    
    .menu-sidebar {
      width: 250px;
      background: rgba(255,255,255,0.1);
      padding: 2em 1em;
      border-right: 1px solid rgba(255,255,255,0.2);
    }
    
    .menu-content {
      flex: 1;
      padding: 2em;
      overflow-y: auto;
    }
    
    .menu-tab {
      display: block;
      width: 100%;
      padding: 1em;
      margin-bottom: 0.5em;
      background: transparent;
      border: 2px solid rgba(255,255,255,0.3);
      color: white;
      font-size: 1.1em;
      cursor: pointer;
      border-radius: 8px;
      transition: all 0.3s ease;
      text-align: left;
    }
    
    .menu-tab:hover, .menu-tab:focus {
      background: rgba(255,255,255,0.2);
      border-color: rgba(255,255,255,0.6);
      outline: none;
    }
    
    .menu-tab.active {
      background: rgba(255,255,255,0.3);
      border-color: #fff;
    }
    
    .menu-section {
      margin-bottom: 2em;
      display: none;
    }
    
    .menu-section.active {
      display: block;
    }
    
    .menu-section h3 {
      color: #fff;
      margin: 0 0 1em 0;
      font-size: 1.4em;
      font-weight: bold;
      border-bottom: 2px solid rgba(255,255,255,0.3);
      padding-bottom: 0.5em;
    }
    
    .menu-item {
      margin-bottom: 1em;
      padding: 0.8em;
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 6px;
      transition: all 0.3s ease;
    }
    
    .menu-item:hover, .menu-item:focus-within {
      background: rgba(255,255,255,0.1);
      border-color: rgba(255,255,255,0.4);
    }
    
    .menu-item label {
      cursor: pointer;
      display: flex;
      align-items: center;
      font-size: 1em;
    }
    
    .menu-item input[type=checkbox] {
      transform: scale(1.5);
      margin-right: 1em;
      cursor: pointer;
    }
    
    .source-indicator {
      display: inline-block;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-right: 0.5em;
    }
    
    .source-indicator.aic { background: #9c27b0; }
    .source-indicator.met { background: #ffc107; }
    .source-indicator.rijks { background: #ff5722; }
    .source-indicator.cleveland { background: #3f51b5; }
    
    button.save {
      padding: 1em 2em;
      font-size: 1.2em;
      cursor: pointer;
      background: #4caf50;
      border: none;
      border-radius: 8px;
      color: white;
      margin: 0.5em 0.5em 0.5em 0;
      transition: all 0.3s ease;
    }
    
    button.save:hover, button.save:focus {
      background: #45a049;
      outline: 3px solid rgba(255,255,255,0.5);
    }
    
    #loadingInfo {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: #666;
      font-size: 1.5em;
      text-align: center;
    }
    
    /* TV-optimierte Navigation */
    .menu-item:focus-within,
    .menu-tab:focus,
    button:focus {
      outline: 3px solid #fff;
      outline-offset: 2px;
    }
    
    /* Responsive f√ºr verschiedene TV-Gr√∂√üen */
    @media (max-width: 1280px) {
      .menu-container {
        flex-direction: column;
      }
      .menu-sidebar {
        width: 100%;
        height: auto;
        display: flex;
        overflow-x: auto;
        padding: 1em;
      }
      .menu-tab {
        min-width: 150px;
        margin-right: 0.5em;
      }
    }
  </style>
</head>
<body>
  <div id="loadingInfo">Lade Kunstwerke...</div>
  <div id="frame" style="display: none;">
    <div class="passepartout" id="passepartout">
      <div class="inner-frame">
        <img id="art" class="artwork" src="" alt="Kunstwerk">
      </div>
    </div>
  </div>
  <div id="infoBox"></div>
  
  <div id="menuOverlay">
    <div class="menu-container">
      <div class="menu-sidebar">
        <button class="menu-tab active" data-tab="sources">üèõÔ∏è Museen</button>
        <button class="menu-tab" data-tab="types">üé® Kunstarten</button>
        <button class="menu-tab" data-tab="periods">üìÖ Epochen</button>
        <button class="menu-tab" data-tab="departments">üèõÔ∏è Abteilungen</button>
        <button class="menu-tab" data-tab="properties">‚öôÔ∏è Eigenschaften</button>
        <button class="menu-tab" data-tab="settings">üîß Einstellungen</button>
      </div>
      
      <div class="menu-content">
        <div class="menu-section active" id="sources">
          <h3>üèõÔ∏è Museen & Sammlungen</h3>
          <div class="menu-item">
            <label>
              <span class="source-indicator aic"></span>
              <input type="checkbox" id="sourceAIC" checked> 
              Art Institute of Chicago
            </label>
          </div>
          <div class="menu-item">
            <label>
              <span class="source-indicator met"></span>
              <input type="checkbox" id="sourceMET" > 
              Metropolitan Museum New York
            </label>
          </div>
          <div class="menu-item">
            <label>
              <span class="source-indicator cleveland"></span>
              <input type="checkbox" id="sourceCleveland" > 
              Cleveland Museum of Art (Need API-Key)
            </label>
          </div>
          <div class="menu-item">
            <label>
              <span class="source-indicator rijks"></span>
              <input type="checkbox" id="sourceRijks"> 
              Rijksmuseum Amsterdam (Need API-Key)
            </label>
          </div>
        </div>
        
        <div class="menu-section" id="types">
          <h3>üé® Kunstarten</h3>
          <div class="menu-item">
            <label><input type="checkbox" id="sourcePaintings" checked> Gem√§lde</label>
          </div>
          <div class="menu-item">
            <label><input type="checkbox" id="sourcePhotographs"> Fotografien</label>
          </div>
          <div class="menu-item">
            <label><input type="checkbox" id="sourceSculpture"> Skulpturen</label>
          </div>
          <div class="menu-item">
            <label><input type="checkbox" id="sourceDrawings"> Zeichnungen & Drucke</label>
          </div>
          <div class="menu-item">
            <label><input type="checkbox" id="sourceDecorative"> Kunsthandwerk</label>
          </div>
        </div>
        
        <div class="menu-section" id="periods">
          <h3>üìÖ Epochen</h3>
          <div class="menu-item">
            <label><input type="checkbox" id="periodAncient"> Antike (vor 500)</label>
          </div>
          <div class="menu-item">
            <label><input type="checkbox" id="periodMedieval"> Mittelalter (500-1400)</label>
          </div>
          <div class="menu-item">
            <label><input type="checkbox" id="periodRenaissance"> Renaissance (1400-1600)</label>
          </div>
          <div class="menu-item">
            <label><input type="checkbox" id="periodBaroque"> Barock (1600-1750)</label>
          </div>
          <div class="menu-item">
            <label><input type="checkbox" id="periodModern" checked> Modern (1750-1950)</label>
          </div>
          <div class="menu-item">
            <label><input type="checkbox" id="periodContemporary"> Zeitgen√∂ssisch (ab 1950)</label>
          </div>
        </div>
        
        <div class="menu-section" id="departments">
          <h3>üèõÔ∏è Abteilungen</h3>
          <div class="menu-item">
            <label><input type="checkbox" id="deptEuropean" checked> Europ√§ische Kunst</label>
          </div>
          <div class="menu-item">
            <label><input type="checkbox" id="deptAmerican"> Amerikanische Kunst</label>
          </div>
          <div class="menu-item">
            <label><input type="checkbox" id="deptAsian"> Asiatische Kunst</label>
          </div>
          <div class="menu-item">
            <label><input type="checkbox" id="deptModern" checked> Moderne Kunst</label>
          </div>
          <div class="menu-item">
            <label><input type="checkbox" id="deptContemporary"> Zeitgen√∂ssische Kunst</label>
          </div>
        </div>
        
        <div class="menu-section" id="properties">
          <h3>‚öôÔ∏è Eigenschaften</h3>
          <div class="menu-item">
            <label><input type="checkbox" id="onlyPublicDomain"> Nur gemeinfrei</label>
          </div>
          <div class="menu-item">
            <label><input type="checkbox" id="onlyHighRes"> Nur hochaufl√∂sende Bilder</label>
          </div>
          <div class="menu-item">
            <label><input type="checkbox" id="onlyWithImages"> Nur mit Bildern</label>
          </div>
        </div>
        
        <div class="menu-section" id="settings">
          <h3>üîß Einstellungen</h3>
          <div class="menu-item">
            <label>Diashow-Zeit: <span id="timeLabel">30</span> Sekunden</label>
          </div>
          <div class="menu-item">
            <label>Passepartout-Farbe: <span id="colorLabel">Eierschale</span></label>
          </div>
          <div class="menu-item">
            <label>Passepartout-Stil: <span id="styleLabel">Klassisch</span></label>
          </div>
          <div class="menu-item">
            <label>Geladene Werke: <span id="artworkCount">0</span></label>
          </div>
          
          <div style="margin-top: 2em;">
            <button class="save" onclick="applyFiltersAndReload()">üîÑ Filter anwenden & neu laden</button>
            <button class="save" onclick="closeMenu()">‚úÖ Speichern & zur√ºck</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    let artworks = [];
    let allArtworks = [];
    let currentIndex = 0;
    let timer = 30;
    let matColors = ['#e3e0d3', '#cdc4a2', '#7b8579', '#45414a', '#d6d5d9', '#ffffff', '#000000', '#d0d0ff', '#ffe0e0'];
    let colorNames = ['Eierschale', 'Sand', 'Stein', 'Anthrazit', 'Hellgrau', 'Wei√ü', 'Schwarz', 'Blau-Grau', 'Rosa'];
    let colorIndex = 0;
    let styleIndex = 0;
    let styles = ['klassisch', 'modern', 'smart', 'crop', 'cropMax', 'none'];
    let infoVisible = false;
    let infoHoldStart = 0;
    let interval;
    let randomizedOrder = [];
    let menuTabIndex = 0;
    let menuItemIndex = 0;
	
	// NEU: TV Keymap
    const TV_KEYS = {
      RED: 403,
      GREEN: 404,
      YELLOW: 405,
      BLUE: 406,
      RETURN: 27,
      OK: 13,
      UP: 38,
      DOWN: 40,
      LEFT: 37,
      RIGHT: 39
    };

    if (window.__spatialNavigation__) {
      window.__spatialNavigation__.keyMode = 'NONE';
    }

    const img = document.getElementById('art');
    const infoBox = document.getElementById('infoBox');
    const menu = document.getElementById('menuOverlay');
    const passepartout = document.getElementById('passepartout');
    const loadingInfo = document.getElementById('loadingInfo');
    const frame = document.getElementById('frame');

    // Bildlade-Fehlerbehandlung
    img.onerror = function() {
      console.log('Bild konnte nicht geladen werden, √ºberspringe...');
      nextArtwork();
    };

    // Menu Navigation f√ºr TV-Fernbedienung
    function initMenuNavigation() {
      const tabs = document.querySelectorAll('.menu-tab');
      tabs.forEach((tab, index) => {
        tab.addEventListener('click', () => switchTab(tab.dataset.tab));
        tab.addEventListener('keydown', handleTabKeydown);
      });
      
      document.addEventListener('keydown', handleMenuNavigation);
    }

    function switchTab(tabName) {
      // Alle Tabs deaktivieren
      document.querySelectorAll('.menu-tab').forEach(tab => tab.classList.remove('active'));
      document.querySelectorAll('.menu-section').forEach(section => section.classList.remove('active'));
      
      // Gew√§hlten Tab aktivieren
      document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
      document.getElementById(tabName).classList.add('active');
      
      menuItemIndex = 0;
    }

    function handleTabKeydown(e) {
      const tabs = document.querySelectorAll('.menu-tab');
      const currentTab = Array.from(tabs).indexOf(e.target);
      
      switch(e.key) {
        case 'ArrowUp':
          e.preventDefault();
          menuTabIndex = Math.max(0, currentTab - 1);
          tabs[menuTabIndex].focus();
          break;
        case 'ArrowDown':
          e.preventDefault();
          menuTabIndex = Math.min(tabs.length - 1, currentTab + 1);
          tabs[menuTabIndex].focus();
          break;
        case 'ArrowRight':
          e.preventDefault();
          switchTab(e.target.dataset.tab);
          focusFirstMenuItem();
          break;
      }
    }

    function focusFirstMenuItem() {
      const activeSection = document.querySelector('.menu-section.active');
      const firstInput = activeSection.querySelector('input, button');
      if (firstInput) firstInput.focus();
    }

    function handleMenuNavigation(e) {
      if (menu.style.display !== 'flex') return;
      
      const activeSection = document.querySelector('.menu-section.active');
      const focusableElements = activeSection.querySelectorAll('input, button');
      const tabs = document.querySelectorAll('.menu-tab');
      const currentTab = Array.from(tabs).findIndex(tab => tab.classList.contains('active'));
      
      switch(e.key) {
        case 'ArrowLeft':
          e.preventDefault();
          tabs[currentTab].focus();
          break;
        case 'ArrowRight':
          e.preventDefault();
          if (focusableElements.length > 0) {
            focusableElements[0].focus();
          }
          break;
        case 'ArrowUp':
          e.preventDefault();
          if (document.activeElement.classList.contains('menu-tab')) {
            // Navigation zwischen Tabs
            menuTabIndex = (currentTab - 1 + tabs.length) % tabs.length;
            tabs[menuTabIndex].focus();
          } else {
            // Navigation innerhalb des aktuellen Men√ºs
            const currentIndex = Array.from(focusableElements).indexOf(document.activeElement);
            const newIndex = (currentIndex - 1 + focusableElements.length) % focusableElements.length;
            focusableElements[newIndex].focus();
          }
          break;
        case 'ArrowDown':
          e.preventDefault();
          if (document.activeElement.classList.contains('menu-tab')) {
            // Navigation zwischen Tabs
            menuTabIndex = (currentTab + 1) % tabs.length;
            tabs[menuTabIndex].focus();
          } else {
            // Navigation innerhalb des aktuellen Men√ºs
            const currentIndex = Array.from(focusableElements).indexOf(document.activeElement);
            const newIndex = (currentIndex + 1) % focusableElements.length;
            focusableElements[newIndex].focus();
          }
          break;
      }
    }

    // Fisher-Yates Shuffle
    function shuffleArray(array) {
      const shuffled = [...array];
      for (let i = shuffled.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
      }
      return shuffled;
    }

    function createRandomizedOrder() {
      const indices = Array.from({length: artworks.length}, (_, i) => i);
      randomizedOrder = shuffleArray(indices);
      currentIndex = 0;
    }

    function updatePassepartoutStyle() {
      passepartout.style.display = 'flex';
      passepartout.className = 'passepartout';
      
      if (styles[styleIndex] === 'modern') {
        passepartout.classList.add('modern');
      } else if (styles[styleIndex] === 'crop') {
        passepartout.classList.add('crop');
      } else if (styles[styleIndex] === 'cropMax') {
        passepartout.classList.add('cropMax');
      } else if (styles[styleIndex] === 'none') {
        passepartout.classList.add('none');
      } else {	    
        passepartout.classList.add('contain');
      }

      document.getElementById('styleLabel').textContent = styles[styleIndex];
    }

    function setPassepartout(index) {
      const color = matColors[index];
      passepartout.style.background = color;
      document.body.style.background = color;
      document.getElementById('colorLabel').textContent = colorNames[index];
    }

    function getSelectedSources() {
      const sources = [];
      if (document.getElementById('sourceAIC').checked) sources.push('aic');
      if (document.getElementById('sourceMET').checked) sources.push('met');
      if (document.getElementById('sourceRijks').checked) sources.push('rijks');
      if (document.getElementById('sourceCleveland').checked) sources.push('cleveland');
      return sources;
    }

    function getSelectedFilters() {
      const filters = {
        types: [],
        periods: [],
        departments: [],
        properties: []
      };
      
      // Kunstarten
      if (document.getElementById('sourcePaintings').checked) {
        filters.types.push('painting', 'Painting');
      }
      if (document.getElementById('sourcePhotographs').checked) {
        filters.types.push('photograph', 'Photograph', 'photography');
      }
      if (document.getElementById('sourceSculpture').checked) {
        filters.types.push('sculpture', 'Sculpture');
      }
      if (document.getElementById('sourceDrawings').checked) {
        filters.types.push('drawing', 'Drawing', 'print', 'Print');
      }
      if (document.getElementById('sourceDecorative').checked) {
        filters.types.push('decorative', 'Decorative', 'vessel', 'furniture');
      }
      
      // Epochen
      const periods = [
        {id: 'periodAncient', start: -3000, end: 500},
        {id: 'periodMedieval', start: 500, end: 1400},
        {id: 'periodRenaissance', start: 1400, end: 1600},
        {id: 'periodBaroque', start: 1600, end: 1750},
        {id: 'periodModern', start: 1750, end: 1950},
        {id: 'periodContemporary', start: 1950, end: 2030}
      ];
      
      periods.forEach(period => {
        if (document.getElementById(period.id).checked) {
          filters.periods.push({start: period.start, end: period.end});
        }
      });
      
      // Abteilungen
      if (document.getElementById('deptEuropean').checked) {
        filters.departments.push('European', 'Painting', 'Sculpture');
      }
      if (document.getElementById('deptAmerican').checked) {
        filters.departments.push('American');
      }
      if (document.getElementById('deptAsian').checked) {
        filters.departments.push('Asian', 'Arts of Asia');
      }
      if (document.getElementById('deptModern').checked) {
        filters.departments.push('Modern', 'Contemporary');
      }
      if (document.getElementById('deptContemporary').checked) {
        filters.departments.push('Contemporary');
      }
      
      // Eigenschaften
      if (document.getElementById('onlyPublicDomain').checked) {
        filters.properties.push('publicDomain');
      }
      if (document.getElementById('onlyHighRes').checked) {
        filters.properties.push('highRes');
      }
      if (document.getElementById('onlyWithImages').checked) {
        filters.properties.push('withImages');
      }
      
      return filters;
    }

    function filterArtworks() {
      const selectedFilters = getSelectedFilters();
      let filteredWorks = [...allArtworks];
      
      // Filter nach Kunstarten
      if (selectedFilters.types.length > 0) {
        filteredWorks = filteredWorks.filter(artwork => 
          selectedFilters.types.some(filter => 
            (artwork.classification_title && 
             artwork.classification_title.toLowerCase().includes(filter.toLowerCase())) ||
            (artwork.objectName && 
             artwork.objectName.toLowerCase().includes(filter.toLowerCase())) ||
            (artwork.objectTypes && 
             artwork.objectTypes.some(type => type.toLowerCase().includes(filter.toLowerCase())))
          )
        );
      }
      
      // Filter nach Epochen
      if (selectedFilters.periods.length > 0) {
        filteredWorks = filteredWorks.filter(artwork => {
          const startYear = artwork.date_start || artwork.objectBeginDate || artwork.dating?.yearEarly;
          if (!startYear) return false;
          return selectedFilters.periods.some(period => 
            startYear >= period.start && startYear <= period.end
          );
        });
      }
      
      // Filter nach Eigenschaften
      selectedFilters.properties.forEach(prop => {
        switch(prop) {
          case 'publicDomain':
            filteredWorks = filteredWorks.filter(artwork => 
              artwork.is_public_domain === true || artwork.isPublicDomain === true);
            break;
          case 'highRes':
            filteredWorks = filteredWorks.filter(artwork => 
              artwork.is_zoomable === true || artwork.hasImage === true);
            break;
          case 'withImages':
            filteredWorks = filteredWorks.filter(artwork => 
              artwork.image_id || artwork.primaryImage || artwork.hasImage);
            break;
        }
      });
      
      artworks = filteredWorks;
      createRandomizedOrder();
      document.getElementById('artworkCount').textContent = artworks.length;
    }

    // AIC API (Art Institute of Chicago)
    async function loadAICData() {
      const results = [];
      const totalPages = 3;
      
      for (let page = 1; page <= totalPages; page++) {
        try {
          const res = await fetch(`https://api.artic.edu/api/v1/artworks?page=${page}&limit=100&fields=id,title,image_id,artist_display,date_display,date_start,classification_title,department_title,place_of_origin,medium_display,dimensions,credit_line,main_reference_number,is_on_view,is_public_domain,is_zoomable,gallery_title`);
          
          if (!res.ok) continue;
          const data = await res.json();
          
          const filteredData = data.data.filter(artwork => 
            artwork.image_id && artwork.title && artwork.artist_display
          ).map(artwork => ({
            ...artwork,
            source: 'aic',
            imageUrl: `https://www.artic.edu/iiif/2/${artwork.image_id}/full/1024,/0/default.jpg`
          }));
          
          results.push(...filteredData);
          await new Promise(resolve => setTimeout(resolve, 200));
        } catch (error) {
          console.error('AIC API Error:', error);
        }
      }
      
      return results;
    }

    // MET API (Metropolitan Museum)
    async function loadMETData() {
      const results = [];
      
      try {
        // Hole Department IDs
        const deptRes = await fetch('https://collectionapi.metmuseum.org/public/collection/v1/departments');
        const departments = await deptRes.json();
        
        // Hole Object IDs f√ºr Gem√§lde und Skulpturen
        const objectRes = await fetch('https://collectionapi.metmuseum.org/public/collection/v1/search?hasImages=true&q=painting');
        const objectData = await objectRes.json();
        
        if (objectData.objectIDs) {
          // Nehme nur die ersten 200 Objekte
          const limitedIds = objectData.objectIDs.slice(0, 200);
          
          for (let i = 0; i < limitedIds.length; i++) {
            try {
              const objRes = await fetch(`https://collectionapi.metmuseum.org/public/collection/v1/objects/${limitedIds[i]}`);
              const objData = await objRes.json();
              
              if (objData.primaryImage && objData.title && objData.artistDisplayName) {
                results.push({
                  id: objData.objectID,
                  title: objData.title,
                  image_id: objData.objectID,
                  artist_display: objData.artistDisplayName,
                  date_display: objData.objectDate,
                  date_start: objData.objectBeginDate,
                  classification_title: objData.objectName,
                  department_title: objData.department,
                  place_of_origin: objData.country,
                  medium_display: objData.medium,
                  dimensions: objData.dimensions,
                  credit_line: objData.creditLine,
                  is_public_domain: objData.isPublicDomain,
                  is_zoomable: true,
                  source: 'met',
                  imageUrl: objData.primaryImage
                });
              }
              await new Promise(resolve => setTimeout(resolve, 50));
            } catch (error) {
              console.error('MET Object Error:', error);
            }
          }
        }
      } catch (error) {
        console.error('MET API Error:', error);
      }
      
      return results;
    }

    // Cleveland Museum of Art API Integration
    async function loadClevelandData() {
      const results = [];
      const totalPages = 2;
      
      try {
        for (let page = 1; page <= totalPages; page++) {
          const res = await fetch(`https://openaccess-api.clevelandart.org/api/artworks/?limit=100&page=${page}&has_image=1`);
          
          if (!res.ok) continue;
          const data = await res.json();
          
          const filteredData = data.data.filter(artwork => 
            artwork.images?.web?.url && 
            artwork.title && 
            (artwork.creators?.[0]?.description || artwork.culture?.[0])
          ).map(artwork => ({
            id: artwork.id,
            title: artwork.title,
            image_id: artwork.id,
            artist_display: artwork.creators?.[0]?.description || artwork.culture?.[0] || 'Unbekannter K√ºnstler',
            date_display: artwork.creation_date || '',
            date_start: artwork.creation_date_earliest || 0,
            classification_title: artwork.type || 'Artwork',
            department_title: artwork.department || 'Cleveland Museum of Art',
            place_of_origin: artwork.culture?.[0] || artwork.technique?.[0] || '',
            medium_display: artwork.technique?.[0] || artwork.materials?.[0] || '',
            dimensions: artwork.measurements?.[0] || '',
            credit_line: artwork.copyright || 'Public Domain',
            is_public_domain: true, // Cleveland stellt nur gemeinfreie Werke zur Verf√ºgung
            is_zoomable: true,
            source: 'cleveland',
            imageUrl: artwork.images.web.url.replace('/crop/', '/full/').replace('!200,200', '!1200,1200')
          }));
          
          results.push(...filteredData);
          await new Promise(resolve => setTimeout(resolve, 200));
        }
      } catch (error) {
        console.error('Cleveland API Error:', error);
      }
      
      return results;
    }

    // Rijksmuseum API
    async function loadRijksData() {
      const results = [];
      const apiKey = '0fiuZFh4'; // Public API key
      const totalPages = 2;
      
      try {
        for (let page = 1; page <= totalPages; page++) {
          const res = await fetch(`https://www.rijksmuseum.nl/api/en/collection?key=${apiKey}&p=${page}&ps=100&imgonly=true&toppieces=true`);
          const data = await res.json();
          
          if (data.artObjects) {
            const filteredData = data.artObjects.filter(artwork => 
              artwork.webImage && artwork.title && artwork.principalOrFirstMaker
            ).map(artwork => ({
              id: artwork.id,
              title: artwork.title,
              image_id: artwork.id,
              artist_display: artwork.principalOrFirstMaker,
              date_display: artwork.longTitle.split(', ').pop(),
              date_start: artwork.dating?.yearEarly || 0,
              classification_title: artwork.objectTypes?.[0] || 'Artwork',
              department_title: 'Rijksmuseum',
              place_of_origin: artwork.productionPlaces?.[0] || 'Netherlands',
              medium_display: artwork.materials?.[0] || '',
              dimensions: '',
              credit_line: '',
              is_public_domain: true,
              is_zoomable: true,
              source: 'rijks',
              imageUrl: artwork.webImage.url.replace('=s0', '=s1000')
            }));
            
            results.push(...filteredData);
            await new Promise(resolve => setTimeout(resolve, 200));
          }
        }
      } catch (error) {
        console.error('Rijksmuseum API Error:', error);
      }
      
      return results;
    }

    // Aktualisierte loadAllArtworks Funktion
    async function loadAllArtworks() {
      loadingInfo.style.display = 'block';
      frame.style.display = 'none';
      
      allArtworks = [];
      const selectedSources = getSelectedSources();
      
      try {
        loadingInfo.textContent = 'Lade Daten von Museen...';
        
        if (selectedSources.includes('aic')) {
          loadingInfo.textContent = 'Lade Art Institute of Chicago...';
          const aicData = await loadAICData();
          allArtworks.push(...aicData);
        }
        
        if (selectedSources.includes('met')) {
          loadingInfo.textContent = 'Lade Metropolitan Museum...';
          const metData = await loadMETData();
          allArtworks.push(...metData);
        }
        
        if (selectedSources.includes('rijks')) {
          loadingInfo.textContent = 'Lade Rijksmuseum...';
          const rijksData = await loadRijksData();
          allArtworks.push(...rijksData);
        }
        
        if (selectedSources.includes('cleveland') && document.getElementById('sourceCleveland').checked) {
          loadingInfo.textContent = 'Lade Cleveland Museum...';
          const clevelandData = await loadClevelandData();
          allArtworks.push(...clevelandData);
        }
        
        console.log(`Insgesamt ${allArtworks.length} Kunstwerke geladen`);
        
        filterArtworks();
        
        if (artworks.length > 0) {
          loadingInfo.style.display = 'none';
          frame.style.display = 'flex';
          showArtwork();
          startSlideshow();
        } else {
          loadingInfo.textContent = 'Keine Kunstwerke gefunden. Bitte Filter anpassen.';
        }
      } catch (error) {
        console.error('Fehler beim Laden der Kunstwerke:', error);
        loadingInfo.textContent = 'Fehler beim Laden der Kunstwerke. Bitte neu laden.';
      }
    }
	function showArtwork() {
      if (!artworks.length || !randomizedOrder.length) return;
      
      const randomIndex = randomizedOrder[currentIndex % randomizedOrder.length];
      const artwork = artworks[randomIndex];
      
      // Bild je nach Quelle laden
      img.src = artwork.imageUrl || 
                (artwork.source === 'aic' ? `https://www.artic.edu/iiif/2/${artwork.image_id}/full/1024,/0/default.jpg` : 
                 artwork.source === 'met' ? artwork.primaryImage : 
                 artwork.source === 'rijks' ? artwork.webImage?.url.replace('=s0', '=s1000') : 
                 artwork.source === 'cleveland' ? artwork.imageUrl : '');
      
      // Source-spezifische Tags
      const sourceTag = artwork.source === 'aic' ? '<span class="tag aic">Art Institute Chicago</span>' :
                       artwork.source === 'met' ? '<span class="tag met">Metropolitan Museum</span>' :
                       artwork.source === 'rijks' ? '<span class="tag rijks">Rijksmuseum</span>' :
                       artwork.source === 'cleveland' ? '<span class="tag cleveland">Cleveland Museum</span>' : '';
      
      infoBox.innerHTML = `
        <div class="artwork-info">
          <div class="title-section">
            <strong>${artwork.title}</strong>
            ${artwork.date_display ? `<span class="date">(${artwork.date_display})</span>` : ''}
          </div>
          
          <div class="artist-section">
            ${artwork.artist_display || 'Unbekannter K√ºnstler'}
          </div>
          
          <div class="details-section">
            ${artwork.place_of_origin ? `<div><em>Herkunft:</em> ${artwork.place_of_origin}</div>` : ''}
            ${artwork.medium_display ? `<div><em>Technik:</em> ${artwork.medium_display}</div>` : ''}
            ${artwork.dimensions ? `<div><em>Gr√∂√üe:</em> ${artwork.dimensions}</div>` : ''}
            ${artwork.credit_line ? `<div class="credit-line">${artwork.credit_line}</div>` : ''}
          </div>
          
          <div class="meta-section">
            ${sourceTag}
            ${artwork.department_title ? `<span class="tag">${artwork.department_title}</span>` : ''}
            ${artwork.is_on_view ? '<span class="tag on-view">Aktuell ausgestellt</span>' : ''}
            ${artwork.is_public_domain ? '<span class="tag public-domain">Gemeinfrei</span>' : ''}
            ${artwork.gallery_title ? `<span class="tag gallery">Galerie ${artwork.gallery_title}</span>` : ''}
          </div>
          
          <div class="source-section">
            <small>Quelle: ${artwork.source === 'aic' ? 'Art Institute of Chicago' : 
                           artwork.source === 'met' ? 'Metropolitan Museum' : 
                           artwork.source === 'rijks' ? 'Rijksmuseum' : 
                           artwork.source === 'cleveland' ? 'Cleveland Museum' : 'Unbekannt'}</small>
            ${artwork.id ? `<small>ID: ${artwork.id}</small>` : ''}
          </div>
        </div>
      `;
    }

    function startSlideshow() {
      clearInterval(interval);
      interval = setInterval(() => {
        currentIndex++;
        
        if (currentIndex >= randomizedOrder.length) {
          createRandomizedOrder();
        }
        
        showArtwork();
      }, timer * 1000);
      document.getElementById('timeLabel').textContent = timer;
    }

    function toggleInfo() {
      infoVisible = !infoVisible;
      infoBox.style.display = infoVisible ? 'block' : 'none';
    }

    function toggleMenu() {
      menu.style.display = menu.style.display === 'flex' ? 'none' : 'flex';
      if (menu.style.display === 'flex') {
        document.querySelector('.menu-tab.active').focus();
      }
    }

    function closeMenu() {
      menu.style.display = 'none';
    }

    function applyFiltersAndReload() {
      loadAllArtworks();
      closeMenu();
    }

    function nextArtwork() {
      currentIndex++;
      if (currentIndex >= randomizedOrder.length) {
        createRandomizedOrder();
      }
      showArtwork();
    }

    function previousArtwork() {
      currentIndex = (currentIndex - 1 + randomizedOrder.length) % randomizedOrder.length;
      showArtwork();
    }
	    // Verbesserte Men√º-Navigation
    function handleMenuNavigation(e) {
      if (menu.style.display !== 'flex') return;
      
      const activeSection = document.querySelector('.menu-section.active');
      const focusableElements = activeSection.querySelectorAll('input, button');
      const tabs = document.querySelectorAll('.menu-tab');
      const currentTab = Array.from(tabs).findIndex(tab => tab.classList.contains('active'));
      
      switch(e.key) {
        case 'ArrowLeft':
          e.preventDefault();
          tabs[currentTab].focus();
          break;
        case 'ArrowRight':
          e.preventDefault();
          if (focusableElements.length > 0) {
            focusableElements[0].focus();
          }
          break;
        case 'ArrowUp':
          e.preventDefault();
          if (document.activeElement.classList.contains('menu-tab')) {
            // Navigation zwischen Tabs
            menuTabIndex = Math.max(0, currentTab - 1);
            tabs[menuTabIndex].focus();
          } else {
            // Navigation innerhalb des aktuellen Men√ºs
            const currentIndex = Array.from(focusableElements).indexOf(document.activeElement);
            const newIndex = Math.max(0, currentIndex - 1);
            focusableElements[newIndex].focus();
          }
          break;
        case 'ArrowDown':
          e.preventDefault();
          if (document.activeElement.classList.contains('menu-tab')) {
            // Navigation zwischen Tabs
            menuTabIndex = Math.min(tabs.length - 1, currentTab + 1);
            tabs[menuTabIndex].focus();
          } else {
            // Navigation innerhalb des aktuellen Men√ºs
            const currentIndex = Array.from(focusableElements).indexOf(document.activeElement);
            const newIndex = Math.min(focusableElements.length - 1, currentIndex + 1);
            focusableElements[newIndex].focus();
          }
          break;
      }
    }

    document.addEventListener('keydown', (e) => {
      const code = e.keyCode || e.which;
      const key = e.key;

      if (menu.style.display === 'flex') {
        handleMenuNavigation(e);
        if (code === TV_KEYS.RETURN || key === 'Escape' || key.toLowerCase() === 'm') {
          closeMenu();
        }
        return;
      }
    
      switch (code) {
        case TV_KEYS.RIGHT:
          nextArtwork();
          break;
        case TV_KEYS.LEFT:
          previousArtwork();
          break;
        case TV_KEYS.UP:
          if (infoHoldStart === 0) infoHoldStart = Date.now();
          break;
        case TV_KEYS.DOWN:
          infoBox.style.display = 'none';
          infoVisible = false;
          infoHoldStart = 0;
          break;
        case TV_KEYS.GREEN:
        case 71: // g
        case 32: // Space
          colorIndex = (colorIndex + 1) % matColors.length;
          setPassepartout(colorIndex);
          break;
        case TV_KEYS.YELLOW:
        case 89: // y
        case 68: // d
          timer += 15;
          startSlideshow();
          break;
        case TV_KEYS.BLUE:
        case 66: // b
        case 65: // a
          timer = Math.max(5, timer - 15);
          startSlideshow();
          break;
        case TV_KEYS.RED:
        case 77: // m
        case 82: // r
          toggleMenu();
          break;
        case TV_KEYS.OK:
          styleIndex = (styleIndex + 1) % styles.length;
          updatePassepartoutStyle();
          break;
        default:
          if (key === 'n') {
            createRandomizedOrder();
            showArtwork();
          }
      }
    });

    document.addEventListener('keyup', (e) => {
      const code = e.keyCode || e.which;
      if ((code === TV_KEYS.UP || e.key === 'ArrowUp') && infoHoldStart > 0) {
        const held = Date.now() - infoHoldStart;
        infoHoldStart = 0;
        if (held > 3000) {
          if (!document.fullscreenElement) {
            document.documentElement.requestFullscreen();
          } else {
            document.exitFullscreen();
          }
        } else {
          toggleInfo();
        }
      }
    });

    // Initialisierung
    setPassepartout(colorIndex);
    updatePassepartoutStyle();
    initMenuNavigation();
    loadAllArtworks();
  </script>
</body>
</html>
	
	